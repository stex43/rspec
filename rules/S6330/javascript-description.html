<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The queue contains sensitive data that could cause harm when leaked.</p>
</li>
<li>
<p>There are compliance requirements for the service to store data encrypted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of those questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no further modifications to the application are necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Queue } from 'aws-cdk-lib/aws-sqs';

new Queue(this, 'example'); // Sensitive</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { CfnQueue } from 'aws-cdk-lib/aws-sqs';

new CfnQueue(this, 'example'); // Sensitive</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { Queue } from 'aws-cdk-lib/aws-sqs';

new Queue(this, 'example', {
    encryption: QueueEncryption.KMS_MANAGED
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import { CfnQueue } from 'aws-cdk-lib/aws-sqs';

const encryptionKey = new Key(this, 'example', {
    enableKeyRotation: true,
});

new CfnQueue(this, 'example', {
    kmsMasterKeyId: encryptionKey.keyId
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures</p>
</li>
<li>
<p><a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">OWASP Top 10 2021 Category A4</a> - Insecure Design</p>
</li>
<li>
<p><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html">AWS Documentation</a> - Encryption at rest</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html">OWASP Top 10 2017 Category A6</a> - Security Misconfiguration</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/311">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>For CfnQueue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Omitting "kmsMasterKeyId" disables SQS queues encryption. Make sure it is safe here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Queue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Omitting "encryption" disables SQS queues encryption. Make sure it is safe here.</p>
</li>
<li>
<p>Setting "encryption" to "QueueEncryption.UNENCRYPTED" disables SQS queues encryption. Make sure it is safe here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>Highlight the initializer function if it does not contain the third argument <code>props</code> or <code>props</code> is set to <code>undefined</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Highlight the <code>props</code> object if it does not contain the property <code>encryption</code>.</p>
</li>
<li>
<p>Highlight the <code>encryption</code> attribute if it is set to <code>QueueEncryption.UNENCRYPTED</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For CfnQueue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Highlight the <code>props</code> object if it does not contain the property <code>kmsMasterKeyId</code>.</p>
</li>
<li>
<p>Highlight the <code>kmsMasterKeyId</code> attribute if it is set to <code>undefined</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>