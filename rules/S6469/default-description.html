<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker offers a feature to mount files and directories for specific <code>RUN</code>
instructions when building Docker images. This feature can be used to provide
secrets to the commands that are executed during the build without baking them
into the image. Additionally, it can be used to access SSH agents during the
build.</p>
</div>
<div class="paragraph">
<p>By using the <code>mode</code> option the permissions of the secrets or agents can be
modified. By default, access is limited to the root user.</p>
</div>
<div class="paragraph">
<p>When such secrets are exposed with lax permissions, they might get compromised
during the image build process. A successful compromise can only happen during
the execution of the command the <code>mount</code> option has been added to. While this
might seem like a very hard exploitation requirement, supply chain attacks, and
other related threats, should still be considered.</p>
</div>
<div class="paragraph">
<p>If you are executing a command as a low-privileged user and need to access
secrets or agents, you can use the options <code>uid</code> and <code>gid</code> to provide access
without having to resort to world-readable or writable permissions that might
expose them to unintended parties.</p>
</div>
<div class="sect2">
<h3 id="_noncompliant_code_example">Noncompliant code example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">RUN --mount=type=secret,id=build_secret,mode=0777 ./installer.sh # Noncompliant</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliant_solution">Compliant solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">RUN --mount=type=secret,id=build_secret,uid=1000 ./installer.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/732">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource</p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret">Dockerfile reference</a> - RUN --mount</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>For secret:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove world permissions for this sensitive file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For ssh:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove world permissions for this sensitive agent.</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>