<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authorizing anonymous access can reduce an organization&#8217;s ability to protect itself against attacks on its Azure resources.</p>
</div>
<div class="paragraph">
<p>Security incidents may include disrupting critical functions, data theft, and additional Azure subscription costs due to resource overload.</p>
</div>
<div class="paragraph">
<p>Using authentication coupled with fine-grained authorizations helps bring Defense-In-Depth and bring traceability to investigators of security incidents.</p>
</div>
<div class="paragraph">
<p>Depending on the affected Azure resource, multiple authentication choices are possible: Active Directory Authentication, OpenID implementations (Google, Microsoft, etc.) or native Azure mechanisms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ask_yourself_whether">Ask Yourself Whether</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>This Azure resource is essential for the information system infrastructure.</p>
</li>
<li>
<p>This Azure resource is essential for mission-critical functions.</p>
</li>
<li>
<p>This Azure resource stores or processes sensitive data.</p>
</li>
<li>
<p>Compliance policies require access to this resource to be authenticated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is a risk if you answered yes to any of these questions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recommended_secure_coding_practices">Recommended Secure Coding Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enable authentication in this Azure resource, and disable anonymous access.</p>
</div>
<div class="paragraph">
<p>If only Basic Authentication is available, enable it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sensitive_code_example">Sensitive Code Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Service</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "2022-03-01",
            "name": "example"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "example"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.DataFactory/factories/linkedservices",
            "apiVersion": "2018-06-01",
            "name": "example",
            "properties": {
                "type": "Web",
                "typeProperties": {
                    "authenticationType": "Anonymous"
                }
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts and Storage Containers</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "properties": {
                "allowBlobPublicAccess": true
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "resources": [
                {
                    "type": "blobServices/containers",
                    "apiVersion": "2022-09-01",
                    "name": "blobContainerExample",
                    "properties": {
                        "publicAccess": "Blob"
                    }
                }
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Cache/redis",
            "apiVersion": "2022-06-01",
            "name": "example",
            "properties": {
                "redisConfiguration": {
                    "authnotrequired": "true"
                }
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compliant_solution">Compliant Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services and equivalent</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Web/sites",
            "apiVersion": "2022-03-01",
            "name": "example",
            "resources": [
                {
                    "type": "config",
                    "apiVersion": "2022-03-01",
                    "name": "authsettingsV2",
                    "properties": {
                        "globalValidation": {
                            "requireAuthentication": true,
                            "unauthenticatedClientAction": "RedirectToLoginPage"
                        },
                        "platform": {
                            "enabled": true
                        }
                    }
                }
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.ApiManagement/service",
            "apiVersion": "2022-09-01-preview",
            "name": "example",
            "resources": [
                {
                    "type": "portalsettings",
                    "apiVersion": "2022-09-01-preview",
                    "name": "signin",
                    "properties": {
                        "enabled": true
                    }
                },
                {
                    "type": "apis",
                    "apiVersion": "2022-09-01-preview",
                    "name": "exampleApi",
                    "properties": {
                        "authenticationSettings": {
                            "openid": {
                                "bearerTokenSendingMethods": ["authorizationHeader"],
                                "openidProviderId": "&lt;an OpenID provider ID&gt;"
                            }
                        }
                    }
                }
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/">Data Factory</a> Linked Services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.DataFactory/factories/linkedservices",
            "apiVersion": "2018-06-01",
            "name": "example",
            "properties": {
                "type": "Web",
                "typeProperties": {
                    "authenticationType": "Basic"
                }
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/">Storage Accounts</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "properties": {
                "allowBlobPublicAccess": false
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "apiVersion": "2022-09-01",
            "name": "example",
            "resources": [
                {
                    "type": "blobServices/containers",
                    "apiVersion": "2022-09-01",
                    "name": "blobContainerExample",
                    "properties": {
                        "publicAccess": "None"
                    }
                }
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/">Redis Caches</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Cache/redis",
            "apiVersion": "2022-06-01",
            "name": "example",
            "properties": {
                "redisConfiguration": {}
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see">See</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">OWASP Top 10 2021 Category A1</a> - Boken Access Control</p>
</li>
<li>
<p><a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">OWASP Top 10 2017 Category A5</a> - Broken Access Control</p>
</li>
<li>
<p><a href="https://cwe.mitre.org/data/definitions/668">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="ulist">
<ul>
<li>
<p>For <code>Microsoft.Web/sites</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If the resource is not found: Omitting <code>authsettingsV2</code> disables authentication. Make sure it is safe here.</p>
</li>
<li>
<p>If <code>properties.platform.enabled == false</code> or <code>properties.globalValidation.requireAuthentication == false</code>: Make sure that disabling authentication is safe here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>Microsoft.ApiManagement/service/portalsettings</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>properties.enabled == false</code>: Make sure that giving anonymous access without enforcing sign-in is safe here.</p>
</li>
<li>
<p>If the resource is not found: Omitting <code>sign_in</code> authorizes anonymous access. Make sure it is safe here.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>Microsoft.ApiManagement/service/apis</code> (if <code>authenticationSettings</code> is not set): Omitting <code>authenticationSettings</code> disables authentication. Make sure it is safe here.</p>
</li>
<li>
<p>For <code>Microsoft.DataFactory/factories/linkedservices</code>: Make sure that authorizing anonymous access is safe here.</p>
</li>
<li>
<p>For <code>Microsoft.Storage/storageAccounts</code>: Make sure that authorizing potential anonymous access is safe here.</p>
</li>
<li>
<p>For <code>Microsoft.Storage/storageAccounts/blobServices/containers</code>: Make sure that authorizing potential anonymous access is safe here.</p>
</li>
<li>
<p>For <code>Microsoft.Cache/redis</code>: Make sure that disabling authentication is safe here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="ulist">
<ul>
<li>
<p>For <code>Microsoft.Web/sites</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>authsettingsV2</code> is not found: Highlight the <code>Web/sites</code> resource.</p>
</li>
<li>
<p>If <code>properties.platform.enabled == false</code> or <code>properties.globalValidation.requireAuthentication == false</code>: Highlight the property.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>Microsoft.ApiManagement/service/portalsettings</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>properties.enabled == false</code>: Highlight the property.</p>
</li>
<li>
<p>If the resource is not found: Highlight the <code>ApiManagement/service</code> resource.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For <code>Microsoft.ApiManagement/service/apis</code> (if <code>authenticationSettings</code> is not set): Highlight the <code>ApiManagement/service/apis</code> resource.</p>
</li>
<li>
<p>For <code>Microsoft.DataFactory/factories/linkedservices</code>: Highlight the <code>authenticationType</code> property.</p>
</li>
<li>
<p>For <code>Microsoft.Storage/storageAccounts</code>: Highlight the <code>properties.allowBlobPublicAccess</code> property.</p>
</li>
<li>
<p>For <code>Microsoft.Storage/storageAccounts/blobServices/containers</code>: Highlight the <code>properties.publicAccess</code> property.</p>
</li>
<li>
<p>For <code>Microsoft.Cache/redis</code>: Highlight the <code>properties.redisConfiguration.authnotrequired</code> property.</p>
</li>
</ul>
</div>
</div>
</div>
</div>