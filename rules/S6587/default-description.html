<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When installing packages an index is cached locally by default.
The index can be used on-the-fly and not stored locally.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_is_this_an_issue">Why is this an issue?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker images should only contain necessary data.
The package index is optional for the correct working of the installed software.
Storing an index also increases the size of the Docker image.
It should be reduced to speed up deployments and reduce storage and bandwidth.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_fix_it">How to fix it</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="sect3">
<h4 id="_noncompliant_code_example">Noncompliant code example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">RUN apk add nginx
RUN apt-get update \
  &amp;&amp; apt-get install nginx
RUN aptitude update \
  &amp;&amp; aptitude install nginx</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compliant_solution">Compliant solution</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker">RUN apk --no-cache add nginx
RUN apk add nginx \
  &amp;&amp; rm -rf /var/lib/apt/lists/*
RUN apk add nginx \
  &amp;&amp; rm -rf /var/cache/apt/archives /var/lib/apt/lists/*

RUN apt-get update \
  &amp;&amp; apt-get install nginx \
  &amp;&amp; apt-get clean
RUN apt-get update \
  &amp;&amp; apt-get install nginx \
  &amp;&amp; rm -rf /var/lib/apt/lists/*
RUN apt-get update \
  &amp;&amp; apt-get install nginx \
  &amp;&amp; rm -rf /var/cache/apt/archives /var/lib/apt/lists/*

RUN aptitude update \
  &amp;&amp; aptitude install nginx \
  &amp;&amp; aptitude clean
RUN aptitude update \
  &amp;&amp; aptitude install nginx \
  &amp;&amp; rm -rf /var/lib/apt/lists/*
RUN aptitude update \
  &amp;&amp; aptitude install nginx \
  &amp;&amp; rm -rf /var/cache/apt/archives /var/lib/apt/lists/*</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_does_this_work">How does this work?</h3>
<div class="paragraph">
<p>When installing packages using <code>apk</code>, <code>apt-get</code>, or <code>aptitude</code> they store an index in the Docker image layer in <code>/var/lib/apt/lists/</code>.
This index is not needed after installation, so it can be removed.
To do that execute the <code>clean</code> command of your package manager tool or just run <code>rm -rf /var/lib/apt/lists/*</code>.
Additionally, some lock files are stored in <code>/var/cache/apt/archives</code>.
They are not removed by the <code>clean</code> command, so they need to be removed manually.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#run">RUN - Best practices for writing Dockerfiles</a></p>
</li>
<li>
<p><a href="https://man.archlinux.org/man/apk.8.en">apk man</a></p>
</li>
<li>
<p><a href="https://linux.die.net/man/8/apt-get">apt-get man</a></p>
</li>
<li>
<p><a href="https://linux.die.net/man/8/aptitude">aptitude man</a></p>
</li>
<li>
<p><a href="https://askubuntu.com/questions/1050800/how-do-i-remove-the-apt-package-index">How do I remove the apt package index?</a></p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_specification">Implementation Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(visible only on this page)</p>
</div>
<div class="sect2">
<h3 id="_message">Message</h3>
<div class="paragraph">
<p>Remove the cache after installing packages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_highlighting">Highlighting</h3>
<div class="paragraph">
<p>Highlight the entire <code>install</code> command.</p>
</div>
<hr>
</div>
</div>
</div>